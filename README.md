# cidtree
Jake Peters

<!-- README.md is generated from README.Rmd. Please edit that file -->

The objectives of `cidtree` package are to

1.  construct a `data.tree` object from a data dictionary

2.  provide convenient functions to explore the data dictionary

3.  automate the mapping of Concept IDs to the associated concepts and
    metadata.

4.  map concepts to their counterparts in the cidtree GCP tables

I intend this to be a toolkit to standardize the way that analysts
interact with the Connect for Cancer Prevention data dictionary.

Here is the **documentation**:
<https://github.com/Analyticsphere/cidtree/blob/main/cidtree_docs.pdf>

## Example

Load dependencies

``` r
library(dplyr)
library(data.tree)
library(jsonlite)
```

#### Install cidtree

``` r
devtools::load_all("./")
```

    ℹ Loading cidtree

<!-- Install cidtree from github -->
<!-- ```{r, echo=TRUE, include=TRUE} -->
<!-- ``` -->

#### Construct data dictionary tree

``` r
path <- "./data/test_dictionary"
dd <- cidtree::construct_dictionary_tree(path)
print(dd, 'concept_str')
```

                   levelName                                        concept_str
    1  0                     DICT: connect4cancer                              
    2   ¦--129084651          PRI_SRC: Survey                                  
    3   ¦   °--965707586       SEC_SRC: Smoking, Alcohol, and Sun Exposure     
    4   ¦       ¦--194557808      QUEST: How old were you when you first smo...
    5   ¦       ¦--408696162      QUEST: Age first used cigarettes on a regu...
    6   ¦       ¦--535003378      QUEST: None of the above                     
    7   ¦       ¦--639684251      QUEST: Do you smoke cigarettes now?          
    8   ¦       ¦--686310465      QUEST: Tobacco pipe                          
    9   ¦       ¦--712653855      QUEST: Cigarettes (manufactured or hand-ro...
    10  ¦       ¦--763164658      QUEST: How many cigarettes have you smoked...
    11  ¦       ¦--798549704      QUEST: When was the last time you smoked c...
    12  ¦       °--965482317      QUEST: Age first used cigarettes on a regu...
    13  ¦--192505768          PRI_SRC: Recruitment                             
    14  ¦   °--214456996       SEC_SRC: Eligibility Screener                   
    15  ¦       ¦--461488577      QUEST: Email or text invitation              
    16  ¦       ¦--607081902      QUEST: Invitation through my patient porta...
    17  ¦       ¦--827220437      QUEST: Healthcare provider                   
    18  ¦       ¦--942255248      QUEST: Letter or brochure in mail            
    19  ¦       °--948195369      QUEST: PIN match - autogenerated when ente...
    20  ¦--142654897            SRC: How did you hear about this study? (Sel...
    21  ¦--790436165            SRC: Age first used cigarettes on a regular ...
    22  ¦--947205597            SRC: Have you ever used any of these tobacco...
    23  ¦--104430631          RESP: No                                         
    24  ¦--125001209          RESP: Kaiser Permanente Colorado                 
    25  ¦--132232896          RESP: 100 or more                                
    26  ¦--151488193          RESP: 10 or less                                 
    27  ¦--181769837          RESP: Other                                      
    28  ¦--299561721          RESP: Yes, but rarely                            
    29  ¦--300267574          RESP: Kaiser Permanente Hawaii                   
    30  ¦--303349821          RESP: Marshfield Clinic Health System            
    31  ¦--317567178          RESP: In the past month                          
    32  ¦--327912200          RESP: Kaiser Permanente Georgia                  
    33  ¦--353358909          RESP: Yes                                        
    34  ¦--419415087          RESP: No, not at all                             
    35  ¦--452412599          RESP: Kaiser Permanente Northwest                
    36  ¦--484055234          RESP: More than a month ago, but in the past year
    37  ¦--486319890          RESP: 50 to 99                                   
    38  ¦--517700004          RESP: National Cancer Institute                  
    39  ¦--531629870          RESP: HealthPartners                             
    40  ¦--548392715          RESP: Henry Ford Health System                   
    41  ¦--648960871          RESP: Never                                      
    42  ¦--657167265          RESP: Sanford Health                             
    43  ¦--716761013          RESP: Yes, but some days                         
    44  ¦--802197176          RESP: More than 1 year ago                       
    45  ¦--804785430          RESP: Yes, every day                             
    46  ¦--805449318          RESP: 11 to 49                                   
    47  ¦--809703864          RESP: University of Chicago Medicine             
    48  °--812620303          RESP: N/A                                        

#### View data frame version of the data dictionary

``` r
dd$df %>% 
  select(cid, path, key) %>%
  head(5)
```

            cid                               path
    1         0                                  0
    2 129084651                       0, 129084651
    3 965707586            0, 129084651, 965707586
    4 194557808 0, 129084651, 965707586, 194557808
    5 408696162 0, 129084651, 965707586, 408696162
                                                      key
    1                                          dictionary
    2                                              Survey
    3                  Smoking, Alcohol, and Sun Exposure
    4 How old were you when you first smoked a cigarette?
    5 Age first used cigarettes on a regular basis number

#### Retrieve a key, given a cid

``` r
cid <- 639684251
key <- cidtree::get_key(dd, cid)
print(key)
```

    [1] "Do you smoke cigarettes now?"

Retrieve a concept id, given a key

``` r
key <- "Do you smoke cigarettes now?"
cid <- cidtree::get_cid(dd, key)
print(cid)
```

    [1] 639684251

Retrieve all metadata using the cid

``` r
meta <- cidtree::get_meta(dd, cid)
meta$cid
```

    [1] 639684251

``` r
meta$path
```

    [1] "0, 129084651, 965707586, 639684251"

``` r
meta$var_name
```

    [1] "SrvSAS_UseCigsNow_v1r0"

``` r
meta$responses
```

    [1] "419415087, 299561721, 716761013, 804785430"

``` r
meta$concept_type
```

    [1] "QUESTION"
